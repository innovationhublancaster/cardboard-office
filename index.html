<!DOCTYPE html>
	<html lang="en">
		<head>
			<title>VR Office</title>
			<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
			<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
			<style>

				* {
					box-sizing: border-box;
				}

				a {
					color: #6998AC;
					text-decoration: none;
					font-weight: bold;
				}

				body {
					margin: 0px;
					overflow: hidden;
					padding: 0;
				}
				#office {
					position: absolute;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
				}

				#cover {
					position: absolute;
					top: 0;
					left: 0;
					z-index: 100;
					width: 100%;
					height: 100%;
					overflow: hidden;
					background-color: rgba(255, 255, 255, 0.6);
					color: #252525;
					display: block;
					font-family: helvetica, arial, sans-serif;
					padding: 2em 1.5em;
				}

				#cover img {
					margin: 20px auto 5px auto;
					display: block;
					width: 235px;
				}

				#cover h1 {
					text-align: center;
					font-size: 14px;
					letter-spacing: 0.4em;
					text-transform: uppercase;
					margin-bottom: 3em;
				}

				#cover p {
					max-width: 235px;
					margin: 0 auto;
				}

				#start {
					padding: 1em 1.5em;
					background: #6998AC;
					text-transform: uppercase;
					text-align: center;
					width: 100%;
					max-width: 235px;
					color: white;
					margin: 3em auto 0 auto;
					cursor: pointer;
					font-weight: bold;
					letter-spacing: 0.4em;
					font-size: 14px;
				}
			</style>
			</head>
			<body>

				<div id="cover">

					<img src="http://innovationhub.lancaster.ac.uk/wp-content/uploads/2015/01/logo-darkgrey-600.png" alt="Innovation Hub">
					<h1>Cardboard Office</h1>

					<p>
						This is the <a href="http://innovationhub.lancaster.ac.uk">Innovation Hub's</a> VR office for <a href="https://www.google.com/get/cardboard/">Google Cardboard</a>.
						<br>
						<br>
						Source code: <a href="http://git.io/vtwtb">http://git.io/vtwtb</a>
						<br>
						<br>
						Please press start below before rotating and placing in your Google Cardboard.
					</p>

					<div id="start">
						Start
					</div>

				</div>

				<div id="office"></div>

				<!--<script src="js/third-party/threejs/three.js"></script>-->
				<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
				<script src="js/third-party/threejs/StereoEffect.js"></script>
				<script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
				<script src="js/third-party/threejs/OrbitControls.js"></script>

				<script>
				var camera, scene, renderer;
				var effect, controls;
				var element, container, cover;
				var coverActive = true;

				var clock = new THREE.Clock();

				init();
				animate();

				function init() {


					console.log("init");
					renderer = new THREE.WebGLRenderer();
					element = renderer.domElement;
					container = document.getElementById('office');
					container.appendChild(element);

					cover = document.getElementById('cover')
					start = document.getElementById('start')

					start.addEventListener('click', hideCover, false);

					function hideCover() {
						cover.style.display = "none";
						coverActive = false;
						effect = new THREE.StereoEffect(renderer);
						controls.autoRotate = false;
					}

					effect = new THREE.StereoEffect(renderer);

					scene = new THREE.Scene();

					//sphere
				 	width	= window.innerWidth,
					height = window.innerHeight;
					camera = new THREE.PerspectiveCamera(75, width / height, 0.001, 700);

					camera.position.set(0, 0, 0);
					scene.add(camera);

					controls = new THREE.OrbitControls(camera, element);
					controls.rotateUp(Math.PI / 40);
					controls.target.set(
						camera.position.x + 0.1,
						camera.position.y,
						camera.position.z
					);
					controls.noZoom = true;
					controls.noPan = true;
					controls.autoRotate = true;
					controls.autoRotateSpeed = 0.5;


					function setOrientationControls(e) {
						//Will fail on desktop as has no device orientation
						if (!e.alpha || coverActive == true) {
							return;
						}

						controls = new THREE.DeviceOrientationControls(camera, true);
						controls.connect();
						controls.update();

						element.addEventListener('click', fullscreen, false);

						window.removeEventListener('deviceorientation', setOrientationControls, true);
					}

					window.addEventListener('deviceorientation', setOrientationControls, true);

					var sphere = new THREE.Mesh(
						new THREE.SphereGeometry(400, 32, 20),
						new THREE.MeshBasicMaterial({
							map: THREE.ImageUtils.loadTexture('office.jpg')
						})
					);
					sphere.scale.x = -1;
					sphere.transparent = false
					scene.add(sphere);

					var crateTexture = THREE.ImageUtils.loadTexture( 'ideas.png' );
					var crateMaterial = new THREE.SpriteMaterial(
						{ map: crateTexture, color: 0xffffff, fog: false }
					);
					var sprite2 = new THREE.Sprite( crateMaterial );
					sprite2.position.set( 300, 180, 50 );
					sprite2.scale.set( 122, 24.3333, 0 ); // imageWidth, imageHeight
					sprite2.transparent = false
					scene.add( sprite2 );

					var sprite3 = new THREE.Sprite( crateMaterial );
					sprite3.position.set( 200, -50, 150 );
					sprite3.scale.set( 81.3333, 16.222, 0 ); // imageWidth, imageHeight
					sprite3.transparent = false
					scene.add( sprite3 );

					var sprite5 = new THREE.Sprite( crateMaterial );
					sprite5.position.set( 50, 0, 280 );
					sprite5.scale.set( 122, 24.3333, 0 ); // imageWidth, imageHeight
					sprite5.transparent = false
					scene.add( sprite5 );


					var sprite4 = new THREE.Sprite( crateMaterial );
					sprite4.position.set( -300, 200, 100 );
					sprite4.scale.set( 122, 24.3333, 0 ); // imageWidth, imageHeight
					sprite4.transparent = false
					scene.add( sprite4 );

					// var crateTexture2 = THREE.ImageUtils.loadTexture( 'sprite2.png' );
					// var crateMaterial2 = new THREE.SpriteMaterial(
					// 	{ map: crateTexture2, color: 0xffffff, fog: false }
					// );
					// var sprite3 = new THREE.Sprite( crateMaterial2 );
					// sprite3.position.set( 105, 75, 0 );
					// sprite3.scale.set( 60, 60, 1.0 ); // imageWidth, imageHeight
					// sprite3.transparent = false
					// scene.add( sprite3 );


					window.addEventListener('resize', resize, false);
					setTimeout(resize, 1);

					hideCover();

				}


				function resize() {
					var width = container.offsetWidth;
					var height = container.offsetHeight;

					camera.aspect = width / height;
					camera.updateProjectionMatrix();

					renderer.setSize(width, height);
					effect.setSize(width, height);
				}

				function update(dt) {
					resize();

					camera.updateProjectionMatrix();

					controls.update(dt);
				}

				function render(dt) {
					effect.render(scene, camera);
				}

				function animate(t) {
					requestAnimationFrame(animate);

					update(clock.getDelta());
					render(clock.getDelta());
				}

				function fullscreen() {
					if (container.requestFullscreen) {
						container.requestFullscreen();
					} else if (container.msRequestFullscreen) {
						container.msRequestFullscreen();
					} else if (container.mozRequestFullScreen) {
						container.mozRequestFullScreen();
					} else if (container.webkitRequestFullscreen) {
						container.webkitRequestFullscreen();
					}
				}
				</script>
			</body>
		</html>
